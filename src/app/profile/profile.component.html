<div class="profile-container">
    <p-toast></p-toast>

    <ng-container *ngIf="loading">
      <div class="text-center py-10 text-white/80">Loading profile...</div>
    </ng-container>
    <ng-container *ngIf="error">
      <div class="text-center py-10 text-red-400">{{ error }}</div>
    </ng-container>
    <ng-container *ngIf="!loading && !error && userProfile">
      <!-- Profile Header Card -->
      <p-card styleClass="mb-6 bg-opacity-70">
        <div class="flex flex-col md:flex-row items-center">
          <div class="profile-image mb-4 md:mb-0 md:mr-6">
            <p-avatar [image]="userProfile.profilePicture" styleClass="mr-2" size="xlarge" shape="circle"></p-avatar>
            <p-fileUpload mode="basic" name="profile[]" accept="image/*" [auto]="true" chooseLabel="Change Photo" 
                        styleClass="p-button-outlined p-button-sm mt-3" 
                        [showCancelButton]="false"></p-fileUpload>
          </div>
          <div class="profile-header-details">
            <h1 class="text-2xl md:text-3xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-purple-300 to-blue-300">
              {{ userProfile.firstName }} {{ userProfile.lastName }}
            </h1>
            <p class="text-white mb-2">{{ userProfile.email }}</p>
            <p class="text-white opacity-80" *ngIf="userProfile.birthDate">Member since: {{ userProfile.birthDate | date:'MMM yyyy' }}</p>
          </div>
          <div class="ml-auto">
            <p-button label="Edit Profile" icon="pi pi-pencil" (click)="openEditDialog()" styleClass="glass-button"></p-button>
          </div>
        </div>
      </p-card>

      <!-- Profile Content - Media Gallery removed -->
      <!-- No tabview needed as we removed the only tab -->

      <!-- Action Buttons -->
      <div class="flex justify-end mt-6 gap-3">
        <p-button label="Cancel" styleClass="p-button-text"></p-button>
        <p-button label="Save Changes" icon="pi pi-check" (click)="onSubmit()"></p-button>
      </div>
    </ng-container>

    <!-- Edit Profile Dialog -->
    <p-dialog [(visible)]="showEditDialog" [style]="{width: '80vw'}" [modal]="true" styleClass="edit-profile-dialog" 
              header="Edit Profile" [draggable]="false" [resizable]="false">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4">
        <!-- Name Fields -->
        <div class="col-span-1 mb-3">
          <span class="p-float-label">
            <input type="text" pInputText id="editFirstName" [(ngModel)]="editedProfile.firstName" class="w-full" />
            <label for="editFirstName">First Name</label>
          </span>
        </div>
        <div class="col-span-1 mb-3">
          <span class="p-float-label">
            <input type="text" pInputText id="editLastName" [(ngModel)]="editedProfile.lastName" class="w-full" />
            <label for="editLastName">Last Name</label>
          </span>
        </div>
        
        <!-- Contact Fields -->
        <div class="col-span-1 mb-3">
          <span class="p-float-label">
            <input type="email" pInputText id="editEmail" [(ngModel)]="editedProfile.email" class="w-full" />
            <label for="editEmail">Email</label>
          </span>
        </div>
        <div class="col-span-1 mb-3">
          <span class="p-float-label">
            <input type="tel" pInputText id="editPhone" [(ngModel)]="editedProfile.phone" class="w-full" />
            <label for="editPhone">Phone</label>
          </span>
        </div>
        
        <!-- Bio Field -->
        <div class="col-span-2 mb-3">
          <span class="p-float-label">
            <textarea pInputTextarea id="editBio" [(ngModel)]="editedProfile.bio" [rows]="5" class="w-full"></textarea>
            <label for="editBio">Bio</label>
          </span>
        </div>
        
        <!-- Address Fields -->
        <div class="col-span-2 mb-3">
          <span class="p-float-label">
            <input type="text" pInputText id="editAddress" [(ngModel)]="editedProfile.address" class="w-full" />
            <label for="editAddress">Address</label>
          </span>
        </div>
        <div class="col-span-1 mb-3">
          <span class="p-float-label">
            <input type="text" pInputText id="editCity" [(ngModel)]="editedProfile.city" class="w-full" />
            <label for="editCity">City</label>
          </span>
        </div>
        <div class="col-span-1 mb-3">
          <span class="p-float-label">
            <p-dropdown [options]="countries" [(ngModel)]="editedProfile.country" 
                     optionLabel="name" [showClear]="true" styleClass="w-full" id="editCountry"></p-dropdown>
            <label for="editCountry">Country</label>
          </span>
        </div>
      </div>
      <ng-template pTemplate="footer">
        <p-button icon="pi pi-times" (click)="showEditDialog=false" label="Cancel" styleClass="p-button-text"></p-button>
        <p-button icon="pi pi-check" (click)="saveProfileChanges()" label="Save"></p-button>
      </ng-template>
    </p-dialog>

    <!-- Media Display Dialog removed -->
</div>